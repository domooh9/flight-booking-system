{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar ProcessLocking =\n/** @class */\nfunction () {\n  function ProcessLocking() {\n    var _this = this;\n\n    this.locked = new Map();\n\n    this.addToLocked = function (key, toAdd) {\n      var callbacks = _this.locked.get(key);\n\n      if (callbacks === undefined) {\n        if (toAdd === undefined) {\n          _this.locked.set(key, []);\n        } else {\n          _this.locked.set(key, [toAdd]);\n        }\n      } else {\n        if (toAdd !== undefined) {\n          callbacks.unshift(toAdd);\n\n          _this.locked.set(key, callbacks);\n        }\n      }\n    };\n\n    this.isLocked = function (key) {\n      return _this.locked.has(key);\n    };\n\n    this.lock = function (key) {\n      return new Promise(function (resolve, reject) {\n        if (_this.isLocked(key)) {\n          _this.addToLocked(key, resolve);\n        } else {\n          _this.addToLocked(key);\n\n          resolve();\n        }\n      });\n    };\n\n    this.unlock = function (key) {\n      var callbacks = _this.locked.get(key);\n\n      if (callbacks === undefined || callbacks.length === 0) {\n        _this.locked.delete(key);\n\n        return;\n      }\n\n      var toCall = callbacks.pop();\n\n      _this.locked.set(key, callbacks);\n\n      if (toCall !== undefined) {\n        setTimeout(toCall, 0);\n      }\n    };\n  }\n\n  ProcessLocking.getInstance = function () {\n    if (ProcessLocking.instance === undefined) {\n      ProcessLocking.instance = new ProcessLocking();\n    }\n\n    return ProcessLocking.instance;\n  };\n\n  return ProcessLocking;\n}();\n\nfunction getLock() {\n  return ProcessLocking.getInstance();\n}\n\nexports.default = getLock;","map":{"version":3,"sources":["/home/dom/FlyM/node_modules/browser-tabs-lock/processLock.js"],"names":["Object","defineProperty","exports","value","ProcessLocking","_this","locked","Map","addToLocked","key","toAdd","callbacks","get","undefined","set","unshift","isLocked","has","lock","Promise","resolve","reject","unlock","length","delete","toCall","pop","setTimeout","getInstance","instance","getLock","default"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIC,cAAc;AAAG;AAAe,YAAY;AAC5C,WAASA,cAAT,GAA0B;AACtB,QAAIC,KAAK,GAAG,IAAZ;;AACA,SAAKC,MAAL,GAAc,IAAIC,GAAJ,EAAd;;AACA,SAAKC,WAAL,GAAmB,UAAUC,GAAV,EAAeC,KAAf,EAAsB;AACrC,UAAIC,SAAS,GAAGN,KAAK,CAACC,MAAN,CAAaM,GAAb,CAAiBH,GAAjB,CAAhB;;AACA,UAAIE,SAAS,KAAKE,SAAlB,EAA6B;AACzB,YAAIH,KAAK,KAAKG,SAAd,EAAyB;AACrBR,UAAAA,KAAK,CAACC,MAAN,CAAaQ,GAAb,CAAiBL,GAAjB,EAAsB,EAAtB;AACH,SAFD,MAGK;AACDJ,UAAAA,KAAK,CAACC,MAAN,CAAaQ,GAAb,CAAiBL,GAAjB,EAAsB,CAACC,KAAD,CAAtB;AACH;AACJ,OAPD,MAQK;AACD,YAAIA,KAAK,KAAKG,SAAd,EAAyB;AACrBF,UAAAA,SAAS,CAACI,OAAV,CAAkBL,KAAlB;;AACAL,UAAAA,KAAK,CAACC,MAAN,CAAaQ,GAAb,CAAiBL,GAAjB,EAAsBE,SAAtB;AACH;AACJ;AACJ,KAhBD;;AAiBA,SAAKK,QAAL,GAAgB,UAAUP,GAAV,EAAe;AAC3B,aAAOJ,KAAK,CAACC,MAAN,CAAaW,GAAb,CAAiBR,GAAjB,CAAP;AACH,KAFD;;AAGA,SAAKS,IAAL,GAAY,UAAUT,GAAV,EAAe;AACvB,aAAO,IAAIU,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC1C,YAAIhB,KAAK,CAACW,QAAN,CAAeP,GAAf,CAAJ,EAAyB;AACrBJ,UAAAA,KAAK,CAACG,WAAN,CAAkBC,GAAlB,EAAuBW,OAAvB;AACH,SAFD,MAGK;AACDf,UAAAA,KAAK,CAACG,WAAN,CAAkBC,GAAlB;;AACAW,UAAAA,OAAO;AACV;AACJ,OARM,CAAP;AASH,KAVD;;AAWA,SAAKE,MAAL,GAAc,UAAUb,GAAV,EAAe;AACzB,UAAIE,SAAS,GAAGN,KAAK,CAACC,MAAN,CAAaM,GAAb,CAAiBH,GAAjB,CAAhB;;AACA,UAAIE,SAAS,KAAKE,SAAd,IAA2BF,SAAS,CAACY,MAAV,KAAqB,CAApD,EAAuD;AACnDlB,QAAAA,KAAK,CAACC,MAAN,CAAakB,MAAb,CAAoBf,GAApB;;AACA;AACH;;AACD,UAAIgB,MAAM,GAAGd,SAAS,CAACe,GAAV,EAAb;;AACArB,MAAAA,KAAK,CAACC,MAAN,CAAaQ,GAAb,CAAiBL,GAAjB,EAAsBE,SAAtB;;AACA,UAAIc,MAAM,KAAKZ,SAAf,EAA0B;AACtBc,QAAAA,UAAU,CAACF,MAAD,EAAS,CAAT,CAAV;AACH;AACJ,KAXD;AAYH;;AACDrB,EAAAA,cAAc,CAACwB,WAAf,GAA6B,YAAY;AACrC,QAAIxB,cAAc,CAACyB,QAAf,KAA4BhB,SAAhC,EAA2C;AACvCT,MAAAA,cAAc,CAACyB,QAAf,GAA0B,IAAIzB,cAAJ,EAA1B;AACH;;AACD,WAAOA,cAAc,CAACyB,QAAtB;AACH,GALD;;AAMA,SAAOzB,cAAP;AACH,CAvDmC,EAApC;;AAwDA,SAAS0B,OAAT,GAAmB;AACf,SAAO1B,cAAc,CAACwB,WAAf,EAAP;AACH;;AACD1B,OAAO,CAAC6B,OAAR,GAAkBD,OAAlB","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ProcessLocking = /** @class */ (function () {\n    function ProcessLocking() {\n        var _this = this;\n        this.locked = new Map();\n        this.addToLocked = function (key, toAdd) {\n            var callbacks = _this.locked.get(key);\n            if (callbacks === undefined) {\n                if (toAdd === undefined) {\n                    _this.locked.set(key, []);\n                }\n                else {\n                    _this.locked.set(key, [toAdd]);\n                }\n            }\n            else {\n                if (toAdd !== undefined) {\n                    callbacks.unshift(toAdd);\n                    _this.locked.set(key, callbacks);\n                }\n            }\n        };\n        this.isLocked = function (key) {\n            return _this.locked.has(key);\n        };\n        this.lock = function (key) {\n            return new Promise(function (resolve, reject) {\n                if (_this.isLocked(key)) {\n                    _this.addToLocked(key, resolve);\n                }\n                else {\n                    _this.addToLocked(key);\n                    resolve();\n                }\n            });\n        };\n        this.unlock = function (key) {\n            var callbacks = _this.locked.get(key);\n            if (callbacks === undefined || callbacks.length === 0) {\n                _this.locked.delete(key);\n                return;\n            }\n            var toCall = callbacks.pop();\n            _this.locked.set(key, callbacks);\n            if (toCall !== undefined) {\n                setTimeout(toCall, 0);\n            }\n        };\n    }\n    ProcessLocking.getInstance = function () {\n        if (ProcessLocking.instance === undefined) {\n            ProcessLocking.instance = new ProcessLocking();\n        }\n        return ProcessLocking.instance;\n    };\n    return ProcessLocking;\n}());\nfunction getLock() {\n    return ProcessLocking.getInstance();\n}\nexports.default = getLock;\n"]},"metadata":{},"sourceType":"script"}